!function(){"use strict";const e=(s,e)=>{let f=1;var t=document.createElement("style");function c(e,t,o){var n=e[o],e=e[o].querySelector("sup"),e=(e&&(e.textContent=`[${o+1}]`),n.href="#footnote-entry-"+(o+1),n.id=`footnote-entry-${o+1}-ref`,t.id="footnote-entry-"+(o+1),t.querySelector('a[role="doc-backlink"]'));e&&(e.href=`#footnote-entry-${o+1}-ref`)}function d(){var e=s.dom.select("ol");const o=s.dom.select('li[id^="footnote-"]');o.sort((e,t)=>{return parseInt(e.id.split("-").pop(),10)-parseInt(t.id.split("-").pop(),10)}),e.forEach(t=>{for(;t.firstChild;)t.removeChild(t.firstChild);o.forEach(e=>{t.appendChild(e)})})}function l(e,t){e[t].parentNode.removeChild(e[t])}t.type="text/css",t.appendChild(document.createTextNode(`
        .footnote-highlight {
            background-color: yellow !important;
        }
    `)),document.head.appendChild(t),s.ui.registry.addButton("a11y-footnotes",{icon:"custom-footnote-icon",tooltip:"Insert Footnote",onAction:()=>{const a=s.selection.getContent({format:"text"});a?s.windowManager.open({title:"Insert Footnote",body:{type:"panel",items:[{type:"input",name:"footnoteText",label:"Footnote Text"}]},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",text:"Save",primary:!0}],onSubmit:function(e){var t=e.getData(),o=a,t=t.footnoteText,n="footnote-"+(new Date).getTime(),r=f++,o=`<span>${o}<a id="footnote-entry-${n}-ref" role="doc-noteref" aria-labelledby="footnote-entry-${n}" href="#footnote-entry-${n}"><sup>[${r}]</sup></a></span>`,r=`
            <li id="footnote-entry-${n}">
                <span contenteditable="true">${t}</span>
                <a role="doc-backlink" href="#footnote-entry-${n}-ref" aria-label="Back to content">â†µ</a>
            </li>`,l=(s.insertContent(o),(t=s.dom.select('section[role="doc-footnotes"] ol')[0])?t.innerHTML+=r:s.setContent(s.getContent()+`<hr /><section role="doc-footnotes" aria-label="footnotes" contenteditable="false">
                <h3 class="sr-only" id="footnotes-block-${n}">Footnotes</h3>
                <ol>${r.trim()}</ol>
            </section>`),s.dom.select('a[role="doc-noteref"]')),i=s.dom.select('li[id^="footnote-"]');if(l.length!==i.length)console.error("Mismatch between number of footnote references and footnotes");else{let e=l[0],o=i[i.length-1];if(e.href.endsWith("#"+o.id)){c(l,o,0);for(let e=1;e<l.length;e++)o=i[e-1],c(l,o,e);d()}else if(e=l[l.length-1],o=i[i.length-1],!e.href.endsWith("#"+o.id)){for(let t=0;t<l.length;t++)if(e=l[t],o=i[i.length-1],e.href.endsWith("#"+o.id)){c(l,o,t);for(let e=t+1;e<l.length;e++)o=i[e-1],c(l,o,e);break}d()}}e.close()}}):s.windowManager.alert("Please select a word or text to add a footnote.")}}),s.ui.registry.addIcon("custom-footnote-icon",'<img src="../../../icons/footnote.svg" style="height: 28px; width: 28px;"/>'),s.on("input",function(){var n=s.dom.select('a[role="doc-noteref"]'),r=s.dom.select('li[id^="footnote-"]');if(n.length<r.length)if(0==n.length)l(r,0);else for(let o=0;o<r.length;o++){let t=n[o];var e=r[o];if(!t.href.endsWith("#"+e.id)){l(r,o);for(let e=o+1;o<r.length;e++)t=n[e],c(n,r[e],e-1);break}}})};tinymce.PluginManager.add("a11y-footnotes",e)}();